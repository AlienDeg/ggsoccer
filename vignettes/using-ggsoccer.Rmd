---
title: "Using ggsoccer"
author: "Ben Torvaney"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

ggsoccer is a simple, lightweight package for plotting event data onto a soccer 
pitch. It is designed to work easily with ggplot2 and its idioms.

This document shows you how to perform some common tasks around plotting soccer
evend data.

## Data: StatsBombR

To explore the plotting of event data, we'll use the StatsBombR package from 
StatsBomb. This package provides easy access to some of StatsBomb's event data.

We'll also make use of the tidyverse for data manipulation.

```{r, message = FALSE, results = FALSE}
library(tidyverse)

competitions <- StatsBombR::FreeCompetitions()
matches <- StatsBombR::FreeMatches(competitions$competition_id)

events <- 
  matches %>% 
  transpose() %>% 
  map(as_tibble) %>% 
  map_dfr(StatsBombR::get.matchFree) %>% 
  as_tibble()
```

## Pass maps

```{r}
library(ggsoccer)

passes <-
  events %>%
  filter(type.name == "Pass",
         pass.shot_assist) %>%
  mutate(
    x    = map_dbl(location, first),
    y    = map_dbl(location, last),
    xend = map_dbl(pass.end_location, first),
    yend = map_dbl(pass.end_location, last)
  ) %>% 
  select(x, y, xend, yend)

passes

ggplot(passes) +
  annotate_pitch(x_scale = 1.2,
                 y_scale = 0.8) +
  geom_segment(aes(x = x, y = y,
                   xend = xend, yend = yend)) +
  geom_point(aes(x = xend,
                 y = yend)) +
  theme_pitch() +
  xlim(-1, 121) +
  ylim(-1, 81)
```


## Shot maps
